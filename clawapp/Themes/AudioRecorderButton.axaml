<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="using:clawapp.Controls">
  <ControlTheme x:Key="{x:Type controls:AudioRecorderButton}" TargetType="controls:AudioRecorderButton">
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="Cursor" Value="Hand"/>
    <Setter Property="Template">
      <ControlTemplate>
        <Border Background="{TemplateBinding Background}"
                CornerRadius="8"
                Padding="8">
          <Panel>
            <!-- Idle State: Microphone Icon -->
            <Button x:Name="RecordButton"
                    Content="ðŸŽ¤"
                    Classes="secondary icon"
                    IsVisible="{Binding !IsRecording, RelativeSource={RelativeSource TemplatedParent}}"
                    IsEnabled="{Binding IsSupported, RelativeSource={RelativeSource TemplatedParent}}"
                    Command="{Binding RecordCommand, RelativeSource={RelativeSource TemplatedParent}}"
                    ToolTip.Tip="{Binding TooltipText, RelativeSource={RelativeSource TemplatedParent}}"/>
            
            <!-- Recording State: Red indicator + duration + stop button -->
            <StackPanel Orientation="Horizontal"
                        Spacing="8"
                        IsVisible="{Binding IsRecording, RelativeSource={RelativeSource TemplatedParent}}">
              <!-- Recording indicator (red dot) -->
              <Ellipse Width="12" Height="12"
                       Fill="#E53935"
                       VerticalAlignment="Center">
                <Ellipse.Styles>
                  <Style Selector="Ellipse">
                    <Style.Animations>
                      <Animation Duration="0:0:1" IterationCount="INFINITE">
                        <KeyFrame Cue="0%">
                          <Setter Property="Opacity" Value="1"/>
                        </KeyFrame>
                        <KeyFrame Cue="50%">
                          <Setter Property="Opacity" Value="0.3"/>
                        </KeyFrame>
                        <KeyFrame Cue="100%">
                          <Setter Property="Opacity" Value="1"/>
                        </KeyFrame>
                      </Animation>
                    </Style.Animations>
                  </Style>
                </Ellipse.Styles>
              </Ellipse>
              
              <!-- Duration display -->
              <TextBlock Text="{Binding DurationText, RelativeSource={RelativeSource TemplatedParent}}"
                         Classes="caption"
                         VerticalAlignment="Center"
                         MinWidth="40"/>
              
              <!-- Cancel button -->
              <Button Content="âœ•"
                      Classes="icon"
                      Padding="4"
                      Command="{Binding CancelCommand, RelativeSource={RelativeSource TemplatedParent}}"
                      ToolTip.Tip="Cancel recording"/>
              
              <!-- Stop/Send button -->
              <Button Content="â¹"
                      Classes="primary icon"
                      Padding="8"
                      Command="{Binding RecordCommand, RelativeSource={RelativeSource TemplatedParent}}"
                      ToolTip.Tip="Stop and send recording"/>
            </StackPanel>
          </Panel>
        </Border>
      </ControlTemplate>
    </Setter>
    
    <!-- Disabled state when not supported -->
    <Style Selector="^:disabled">
      <Setter Property="Opacity" Value="0.5"/>
    </Style>
  </ControlTheme>
</ResourceDictionary>
